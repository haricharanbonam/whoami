<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IPeek - Your Digital Footprint Analyzer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
        animation: fadeInDown 0.6s ease-out;
      }

      .header h1 {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .main-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        margin-bottom: 30px;
        animation: fadeInUp 0.6s ease-out;
      }

      .ip-display {
        text-align: center;
        padding: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 15px;
        margin-bottom: 30px;
        color: white;
      }

      .ip-display .label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .ip-display .ip-value {
        font-size: 2.5rem;
        font-weight: 700;
        font-family: "Courier New", monospace;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .info-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 25px;
        border-left: 4px solid #667eea;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .info-section:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .info-section h3 {
        color: #667eea;
        font-size: 1.3rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .info-row:last-child {
        border-bottom: none;
      }

      .info-label {
        font-weight: 600;
        color: #666;
      }

      .info-value {
        color: #333;
        text-align: right;
        word-break: break-word;
        max-width: 60%;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .status-online {
        background: #d4edda;
        color: #155724;
      }

      .status-offline {
        background: #f8d7da;
        color: #721c24;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .icon {
        font-size: 1.5rem;
      }

      .footer {
        text-align: center;
        color: white;
        margin-top: 40px;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .ip-display .ip-value {
          font-size: 1.5rem;
        }

        .grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîç IPeek</h1>
        <p>Discover Your Digital Footprint</p>
      </div>

      <div class="main-card">
        <div id="loading" class="loading">
          <div class="spinner"></div>
          <p>Analyzing your connection...</p>
        </div>

        <div id="content" style="display: none">
          <div class="ip-display">
            <div class="label">Your IP Address</div>
            <div class="ip-value" id="ipAddress">Loading...</div>
          </div>

          <div class="grid">
            <div class="info-section">
              <h3><span class="icon">üåç</span> Location</h3>
              <div class="info-row">
                <span class="info-label">Country</span>
                <span class="info-value" id="country">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Region</span>
                <span class="info-value" id="region">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">City</span>
                <span class="info-value" id="city">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Timezone</span>
                <span class="info-value" id="timezone">-</span>
              </div>
            </div>

            <div class="info-section">
              <h3><span class="icon">üíª</span> Browser</h3>
              <div class="info-row">
                <span class="info-label">Name</span>
                <span class="info-value" id="browserName">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Version</span>
                <span class="info-value" id="browserVersion">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Engine</span>
                <span class="info-value" id="engine">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Language</span>
                <span class="info-value" id="language">-</span>
              </div>
            </div>

            <div class="info-section">
              <h3><span class="icon">üñ•Ô∏è</span> System</h3>
              <div class="info-row">
                <span class="info-label">OS</span>
                <span class="info-value" id="osName">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Version</span>
                <span class="info-value" id="osVersion">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Device</span>
                <span class="info-value" id="deviceType">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Model</span>
                <span class="info-value" id="deviceModel">-</span>
              </div>
            </div>

            <div class="info-section">
              <h3><span class="icon">üì±</span> Display</h3>
              <div class="info-row">
                <span class="info-label">Resolution</span>
                <span class="info-value" id="resolution">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Pixel Ratio</span>
                <span class="info-value" id="pixelRatio">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Color Depth</span>
                <span class="info-value" id="colorDepth">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Touchscreen</span>
                <span class="info-value" id="touchscreen">-</span>
              </div>
            </div>

            <div class="info-section">
              <h3><span class="icon">‚ö°</span> Status</h3>
              <div class="info-row">
                <span class="info-label">Connection</span>
                <span class="info-value" id="connectionStatus">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Battery</span>
                <span class="info-value" id="battery">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Theme</span>
                <span class="info-value" id="theme">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Current Time</span>
                <span class="info-value" id="currentTime">-</span>
              </div>
            </div>

            <div class="info-section">
              <h3><span class="icon">üîí</span> Network</h3>
              <div class="info-row">
                <span class="info-label">Protocol</span>
                <span class="info-value" id="protocol">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Host</span>
                <span class="info-value" id="host">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Connection Type</span>
                <span class="info-value" id="connectionType">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">Downlink</span>
                <span class="info-value" id="downlink">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>IPeek - Your Digital Footprint Analyzer ¬© 2024</p>
      </div>
    </div>

    <script>
      async function fetchClientInfo() {
        try {
          const response = await fetch("/api/info");
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error fetching client info:", error);
          return null;
        }
      }

      function getClientSideInfo() {
        const isDarkMode =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const hasTouchscreen =
          "ontouchstart" in window || navigator.maxTouchPoints > 0;

        return {
          screen: {
            width: screen.width,
            height: screen.height,
            availWidth: screen.availWidth,
            availHeight: screen.availHeight,
            colorDepth: screen.colorDepth,
            pixelRatio: window.devicePixelRatio,
          },
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          language: navigator.language,
          languages: navigator.languages,
          darkMode: isDarkMode,
          touchscreen: hasTouchscreen,
          online: navigator.onLine,
          currentTime: new Date().toLocaleString(),
        };
      }

      async function getBatteryInfo() {
        if ("getBattery" in navigator) {
          try {
            const battery = await navigator.getBattery();
            const level = Math.round(battery.level * 100);
            const charging = battery.charging ? "Charging" : "Not Charging";
            return `${level}% (${charging})`;
          } catch (error) {
            return "Not Available";
          }
        }
        return "Not Supported";
      }

      function getConnectionInfo() {
        if (
          "connection" in navigator ||
          "mozConnection" in navigator ||
          "webkitConnection" in navigator
        ) {
          const connection =
            navigator.connection ||
            navigator.mozConnection ||
            navigator.webkitConnection;
          return {
            type: connection.effectiveType || "Unknown",
            downlink: connection.downlink
              ? `${connection.downlink} Mbps`
              : "Unknown",
          };
        }
        return { type: "Not Supported", downlink: "Not Supported" };
      }

      function updateClock() {
        document.getElementById("currentTime").textContent =
          new Date().toLocaleString();
      }

      async function displayInfo() {
        const serverInfo = await fetchClientInfo();
        const clientInfo = getClientSideInfo();
        const batteryInfo = await getBatteryInfo();
        const connectionInfo = getConnectionInfo();

        if (serverInfo) {
          // IP Address
          document.getElementById("ipAddress").textContent =
            serverInfo.ip || "Unknown";

          // Location
          if (serverInfo.geo) {
            document.getElementById("country").textContent =
              serverInfo.geo.country || "Unknown";
            document.getElementById("region").textContent =
              serverInfo.geo.region || "Unknown";
            document.getElementById("city").textContent =
              serverInfo.geo.city || "Unknown";
          } else {
            document.getElementById("country").textContent = "Unknown";
            document.getElementById("region").textContent = "Unknown";
            document.getElementById("city").textContent = "Unknown";
          }
          document.getElementById("timezone").textContent = clientInfo.timezone;

          // Browser
          document.getElementById("browserName").textContent =
            serverInfo.browser.name || "Unknown";
          document.getElementById("browserVersion").textContent =
            serverInfo.browser.version || "Unknown";
          document.getElementById("engine").textContent =
            serverInfo.engine || "Unknown";
          document.getElementById("language").textContent = clientInfo.language;

          // System
          document.getElementById("osName").textContent =
            serverInfo.os.name || "Unknown";
          document.getElementById("osVersion").textContent =
            serverInfo.os.version || "Unknown";
          document.getElementById("deviceType").textContent =
            serverInfo.device.type || "Desktop";
          document.getElementById("deviceModel").textContent =
            serverInfo.device.model || "Unknown";

          // Display
          document.getElementById(
            "resolution"
          ).textContent = `${clientInfo.screen.width} √ó ${clientInfo.screen.height}`;
          document.getElementById("pixelRatio").textContent =
            clientInfo.screen.pixelRatio;
          document.getElementById(
            "colorDepth"
          ).textContent = `${clientInfo.screen.colorDepth}-bit`;
          document.getElementById("touchscreen").textContent =
            clientInfo.touchscreen ? "Yes" : "No";

          // Status
          const onlineStatus = clientInfo.online
            ? '<span class="status-badge status-online">Online</span>'
            : '<span class="status-badge status-offline">Offline</span>';
          document.getElementById("connectionStatus").innerHTML = onlineStatus;
          document.getElementById("battery").textContent = batteryInfo;
          document.getElementById("theme").textContent = clientInfo.darkMode
            ? "Dark Mode"
            : "Light Mode";
          document.getElementById("currentTime").textContent =
            clientInfo.currentTime;

          // Network
          document.getElementById("protocol").textContent =
            serverInfo.headers.protocol.toUpperCase();
          document.getElementById("host").textContent = serverInfo.headers.host;
          document.getElementById("connectionType").textContent =
            connectionInfo.type;
          document.getElementById("downlink").textContent =
            connectionInfo.downlink;
        }

        // Hide loading, show content
        document.getElementById("loading").style.display = "none";
        document.getElementById("content").style.display = "block";

        // Update clock every second
        setInterval(updateClock, 1000);
      }

      // Run on page load
      displayInfo();
    </script>
  </body>
</html>
